{% extends "base.html" %}

{% block content %}
<div class="container mt-4">
    <div class="row mb-5">
        <div class="col-md-12 text-center">
            <h1 class="display-4 fw-bold">AI-Powered Hospital Location Analyzer</h1>
            <p class="lead">Using artificial intelligence to optimize healthcare facility placement for maximum community impact</p>
            <div class="mt-4 mb-5 d-flex justify-content-center">
                <a href="#data-analysis-section" class="btn btn-primary"><i class="fas fa-database me-2"></i>Hospital Data & Analysis</a>
            </div>
        </div>
    </div>

    <!-- AI Features Section -->
    <div class="row mb-5">
        <div class="col-md-12">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0"><i class="fas fa-robot me-2"></i>How AI Powers This Application</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-3 mb-4">
                            <div class="ai-feature h-100">
                                <h5><i class="fas fa-search me-2"></i>Natural Language Search</h5>
                                <p>Ask questions in plain English to find insights about hospitals and population data. The AI understands complex geographic queries and demographic analyses.</p>
                                <div class="small text-muted fst-italic">Example: "Find hospitals near Sydney CBD" or "Most populated areas in western suburbs"</div>
                            </div>
                        </div>
                        <div class="col-md-3 mb-4">
                            <div class="ai-feature h-100">
                                <h5><i class="fas fa-map-marked-alt me-2"></i>Intelligent Location Analysis</h5>
                                <p>Our AI algorithms evaluate potential hospital locations considering population density, demographic data, and existing healthcare coverage.</p>
                                <div class="small text-muted fst-italic">Simply click on the map to get AI recommendations on hospital placement suitability.</div>
                            </div>
                        </div>
                        <div class="col-md-3 mb-4">
                            <div class="ai-feature h-100">
                                <h5><i class="fas fa-chart-bar me-2"></i>Predictive Recommendations</h5>
                                <p>Receive AI-generated percentage scores and detailed explanations for potential hospital locations based on multiple factors.</p>
                                <div class="small text-muted fst-italic">The AI considers over 15 geographic and demographic variables to provide accurate recommendations.</div>
                            </div>
                        </div>
                        <div class="col-md-3 mb-4">
                            <div class="ai-feature h-100">
                                <h5><i class="fas fa-database me-2"></i>Data Integration</h5>
                                <p>Upload your own datasets or use our provided data. The AI can analyze hospital and population data from various sources.</p>
                                <div class="small text-muted fst-italic">Supports GeoJSON for hospital data and CSV/Excel for population statistics.</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Combined Data & Analysis Section -->
    <div class="row mb-5" id="data-analysis-section">
        <div class="col-md-12">
            <div class="card">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0"><i class="fas fa-hospital me-2"></i>Hospital Data & Analysis</h5>
                </div>
                <div class="card-body">
                    <!-- Tabbed Navigation -->
                    <ul class="nav nav-tabs mb-4" id="dataAnalysisTabs" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active" id="search-tab" data-bs-toggle="tab" data-bs-target="#search-content" type="button" role="tab" aria-controls="search-content" aria-selected="true">
                                <i class="fas fa-search me-2"></i>Search Data
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="analyze-tab" data-bs-toggle="tab" data-bs-target="#analyze-content" type="button" role="tab" aria-controls="analyze-content" aria-selected="false">
                                <i class="fas fa-chart-line me-2"></i>Analyze Locations
                            </button>
                        </li>
                    </ul>

                    <!-- Tab Content -->
                    <div class="tab-content" id="dataAnalysisTabContent">
                        <!-- Search Tab -->
                        <div class="tab-pane fade show active" id="search-content" role="tabpanel" aria-labelledby="search-tab">
                            <form action="/search" method="post" enctype="multipart/form-data">
                                <div class="mb-3">
                                    <label for="searchQuery" class="form-label">Search Query</label>
                                    <div class="input-group">
                                        <span class="input-group-text"><i class="fas fa-search"></i></span>
                                        <input type="text" class="form-control" id="searchQuery" name="query"
                                               placeholder="Try: 'general hospitals', '10 most populated areas', or 'areas with population over 50000'">
                                    </div>
                                    <div class="form-text text-muted">Use natural language to ask questions about hospitals and population data</div>
                                </div>

                                <!-- Search time notice -->
                                <div class="alert alert-warning small mb-3">
                                    <i class="fas fa-clock me-2"></i>
                                    <strong>Please note:</strong> Searching and processing data may take some time, especially for complex queries or when using AI analysis. Please be patient while results are being generated.
                                </div>

                                <!-- Dataset Selection -->
                                <div class="mb-4">
                                    <h6 class="mb-2 border-bottom pb-2"><i class="fas fa-database me-2"></i>Data Source Options</h6>
                                    <p class="text-muted small mb-3">Choose which data to search in:</p>

                                    <div class="form-check mb-2">
                                        <input class="form-check-input" type="radio" name="data_source" id="useDefaultData" value="default" checked>
                                        <label class="form-check-label" for="useDefaultData">
                                            <strong>Use Default Dataset</strong> (Sydney, Australia)
                                        </label>
                                        <div class="form-text ms-4">Comprehensive hospital and population data for Sydney metropolitan area</div>
                                    </div>
                                    <div class="form-check mb-2">
                                        <input class="form-check-input" type="radio" name="data_source" id="useDataset" value="selected">
                                        <label class="form-check-label" for="useDataset">
                                            <strong>Select Available Dataset</strong>
                                        </label>
                                        <div class="form-text ms-4">Choose from the list of pre-loaded datasets</div>
                                    </div>
                                    <div class="form-check mb-2">
                                        <input class="form-check-input" type="radio" name="data_source" id="uploadCustom" value="custom">
                                        <label class="form-check-label" for="uploadCustom">
                                            <strong>Upload Custom Data Files</strong>
                                        </label>
                                        <div class="form-text ms-4">Analyze your own hospital and population data</div>
                                    </div>
                                </div>

                                <!-- Dataset Selection Section -->
                                <div id="datasetSearchSection" style="display: none;">
                                    <div class="mb-3">
                                        <label for="datasetSearchSelect" class="form-label">Select Dataset</label>
                                        <select class="form-select" id="datasetSearchSelect" name="selected_dataset">
                                            {% for dataset in datasets %}
                                            <option value="{{ dataset.hospital_file }}|{{ dataset.population_file }}">
                                                {{ dataset.name }}
                                            </option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                </div>

                                <!-- Custom Upload Section -->
                                <div id="uploadSearchSection" style="display: none;">
                                    <div class="alert alert-info small">
                                        <i class="fas fa-info-circle me-2"></i>
                                        Upload your own hospital and population data files to search them. Hospital data must be in GeoJSON format with hospital coordinates. Population data must be in CSV or Excel format with population columns.
                                    </div>

                                    <div class="mb-3">
                                        <label for="hospitalSearchFile" class="form-label">Hospital Data File</label>
                                        <input type="file" class="form-control" id="hospitalSearchFile" name="hospital_file" accept=".json,.geojson">
                                        <div class="form-text">Upload a GeoJSON file containing hospital locations with coordinates</div>
                                    </div>
                                    <div class="mb-3">
                                        <label for="populationSearchFile" class="form-label">Population Data File</label>
                                        <input type="file" class="form-control" id="populationSearchFile" name="population_file" accept=".csv,.xlsx">
                                        <div class="form-text">Upload an Excel or CSV file containing population data with area coordinates</div>
                                    </div>
                                    <div class="form-check mb-3">
                                        <input class="form-check-input" type="checkbox" id="useDefaultIfMissing" name="use_default_if_missing" value="true" checked>
                                        <label class="form-check-label" for="useDefaultIfMissing">
                                            Use default data if uploaded files have errors
                                        </label>
                                    </div>
                                </div>

                                <div class="mb-4">
                                    <h6 class="mb-2 border-bottom pb-2"><i class="fas fa-filter me-2"></i>Search Options</h6>
                                    <label class="form-label">Search Type</label>
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="data_type" id="searchAll" value="all" checked>
                                        <label class="form-check-label" for="searchAll">
                                            All Data
                                        </label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="data_type" id="searchHospitals" value="hospitals">
                                        <label class="form-check-label" for="searchHospitals">
                                            Hospitals Only
                                        </label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="data_type" id="searchPopulation" value="population">
                                        <label class="form-check-label" for="searchPopulation">
                                            Population Only
                                        </label>
                                    </div>
                                </div>
                                <button type="submit" class="btn btn-primary">
                                    <i class="fas fa-search"></i> Search
                                </button>
                            </form>

                            <div class="mt-4">
                                <h6 class="mb-3">Example Searches:</h6>
                                <div class="list-group">
                                    <a href="#" class="list-group-item list-group-item-action" onclick="setSearchQuery('Find the 5 nearest hospitals to Sydney city centre')">
                                        <i class="fas fa-hospital me-2"></i> Find the 5 nearest hospitals to Sydney city centre
                                    </a>
                                    <a href="#" class="list-group-item list-group-item-action" onclick="setSearchQuery('10 most populated districts')">
                                        <i class="fas fa-users me-2"></i> 10 most populated districts
                                    </a>
                                    <a href="#" class="list-group-item list-group-item-action" onclick="setSearchQuery('areas with population over 50000')">
                                        <i class="fas fa-city me-2"></i> Areas with population over 50,000
                                    </a>
                                    <a href="#" class="list-group-item list-group-item-action" onclick="setSearchQuery('hospitals closest to Bondi Beach')">
                                        <i class="fas fa-map-marker-alt me-2"></i> Hospitals closest to Bondi Beach
                                    </a>
                                </div>
                            </div>
                        </div>

                        <!-- Analysis Tab -->
                        <div class="tab-pane fade" id="analyze-content" role="tabpanel" aria-labelledby="analyze-tab">
                            <div class="alert alert-info mb-4">
                                <div class="d-flex">
                                    <div class="me-3">
                                        <i class="fas fa-lightbulb fa-2x text-primary"></i>
                                    </div>
                                    <div>
                                        <strong>How it works:</strong> Our AI analyzes optimal hospital locations based on multiple factors:
                                        <ul class="mt-2 mb-1">
                                            <li>Population density and distribution patterns</li>
                                            <li>Existing healthcare coverage and access gaps</li>
                                            <li>Geographic features and transportation networks</li>
                                            <li>Demographic characteristics of local communities</li>
                                        </ul>
                                        <p class="mb-0">The system identifies underserved regions and provides data-driven recommendations for new facility placement.</p>
                                    </div>
                                </div>
                            </div>
                            <form action="/analyze" method="post" enctype="multipart/form-data">
                                <!-- Dataset Selection -->
                                <div class="mb-4">
                                    <label class="form-label">Analysis Options</label>
                                    <div class="form-check mb-2">
                                        <input class="form-check-input" type="radio" name="analysis_type" id="analysisDataset" value="dataset" checked>
                                        <label class="form-check-label" for="analysisDataset">
                                            <strong>Use Available Dataset</strong>
                                        </label>
                                        <div class="form-text ms-4">Analyze pre-loaded hospital and population data</div>
                                    </div>
                                    <div class="form-check mb-2">
                                        <input class="form-check-input" type="radio" name="analysis_type" id="analysisCustom" value="custom">
                                        <label class="form-check-label" for="analysisCustom">
                                            <strong>Upload Custom Data</strong>
                                        </label>
                                        <div class="form-text ms-4">Use your own dataset for analysis</div>
                                    </div>
                                </div>

                                <!-- Dataset Selection Section -->
                                <div id="datasetSection">
                                    <div class="mb-3">
                                        <label for="datasetSelect" class="form-label">Select Dataset</label>
                                        <select class="form-select" id="datasetSelect" name="dataset">
                                            {% for dataset in datasets %}
                                            <option value="{{ dataset.hospital_file }}|{{ dataset.population_file }}">
                                                {{ dataset.name }}
                                            </option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                    <div class="mb-3">
                                        <details>
                                            <summary>Dataset Details</summary>
                                            <div id="datasetDetails" class="mt-2">
                                                <p class="text-muted">Select a dataset to view details</p>
                                            </div>
                                        </details>
                                    </div>
                                </div>

                                <!-- Custom Upload Section -->
                                <div id="uploadSection" style="display: none;">
                                    <div class="mb-3">
                                        <label for="hospitalFile" class="form-label">Hospital Data File</label>
                                        <input type="file" class="form-control" id="hospitalFile" name="hospital_file" accept=".json,.geojson">
                                        <div class="form-text">Upload GeoJSON with hospital locations and metadata</div>
                                    </div>
                                    <div class="mb-3">
                                        <label for="populationFile" class="form-label">Population Data File</label>
                                        <input type="file" class="form-control" id="populationFile" name="population_file" accept=".csv,.xlsx">
                                        <div class="form-text">Upload demographic data with population statistics</div>
                                    </div>
                                </div>

                                <button type="submit" class="btn btn-primary">
                                    <i class="fas fa-chart-line me-2"></i>Run AI Analysis
                                </button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    // Show/hide dataset selection based on radio button
    document.addEventListener('DOMContentLoaded', function() {
        // For search section
        const dataSourceRadios = document.querySelectorAll('input[name="data_source"]');
        const datasetSearchSection = document.getElementById('datasetSearchSection');
        const uploadSearchSection = document.getElementById('uploadSearchSection');

        dataSourceRadios.forEach(radio => {
            radio.addEventListener('change', function() {
                if (this.value === 'selected') {
                    datasetSearchSection.style.display = 'block';
                    uploadSearchSection.style.display = 'none';
                } else if (this.value === 'custom') {
                    datasetSearchSection.style.display = 'none';
                    uploadSearchSection.style.display = 'block';
                } else {
                    datasetSearchSection.style.display = 'none';
                    uploadSearchSection.style.display = 'none';
                }
            });
        });

        // For analysis section
        const analysisTypeRadios = document.querySelectorAll('input[name="analysis_type"]');
        const datasetSection = document.getElementById('datasetSection');
        const uploadSection = document.getElementById('uploadSection');

        analysisTypeRadios.forEach(radio => {
            radio.addEventListener('change', function() {
                if (this.value === 'dataset') {
                    datasetSection.style.display = 'block';
                    uploadSection.style.display = 'none';
                } else if (this.value === 'custom') {
                    datasetSection.style.display = 'none';
                    uploadSection.style.display = 'block';
                }
            });
        });

        // For dataset details
        const datasetSelect = document.getElementById('datasetSelect');
        const datasetDetails = document.getElementById('datasetDetails');

        if (datasetSelect && datasetDetails) {
            datasetSelect.addEventListener('change', function() {
                // Simple placeholder, in a real app this would populate with actual dataset details
                const selectedOption = datasetSelect.options[datasetSelect.selectedIndex].text;
                datasetDetails.innerHTML = `<strong>${selectedOption}</strong><p>This dataset contains hospital and population information for the selected region.</p>`;
            });
            // Trigger initial load
            datasetSelect.dispatchEvent(new Event('change'));
        }
    });

    // Function to set search query examples
    function setSearchQuery(query) {
        document.getElementById('searchQuery').value = query;
        // Focus the search field
        document.getElementById('searchQuery').focus();
        // Prevent default anchor behavior
        return false;
    }
</script>
{% endblock %}
